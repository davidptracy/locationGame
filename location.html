<html>
	<head>

	<style>

	body {			
		width: 100%;
		font-family: Arial, Verdana, sans-serif;
		font-size:20px;
	}

	</style>

	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">

		// =============================================
		// 1 - connect to node socket.io server
		// =============================================
		var socket = io.connect('/');

		socket.on('connect', function() {
			console.log("Connected");
		});

		var playerArray = [];

		socket.on('locationFromServer', function(locationBroadcast){

			var id = locationBroadcast[0];
			var coords = locationBroadcast[1];

			console.log("Got location from ID " + id);
			console.log("Coordinates " + coords);

			if (checkPlayers(id)){
				document.getElementById("player"+playerArray.indexOf(id)).innerHTML = "Player " + playerArray.indexOf(id) + " : " + coords;
			} else {

				playerArray.push(id);

				var li = document.createElement('li');
				li.id = "player"+playerArray.indexOf(id);

				li.innerHTML = "Player " + playerArray.indexOf(id) + " : " + coords;
				
				playerList.appendChild(li);
			}

		});

		function checkPlayers(playerId){
			return playerArray.indexOf(playerId) > -1;
		}

		var lat;
		var lon;
		var myCoords = [];

		if (navigator.geolocation) {
			//alert("Allowed");

			navigator.geolocation.watchPosition(successCallback, errorCallback, {});

			function successCallback(currentPosition) {
				lat = currentPosition.coords.latitude;
		        lon = currentPosition.coords.longitude;
		        myCoords = [lat, lon];

		        console.log(myCoords);
		        console.log(myCoords[0]);
		        console.log(myCoords[1]);

				// alert("latitude = " + lat + " longitude = " + lon );
				socket.emit ('clientLocation', myCoords )

				document.getElementById("me").innerHTML = "My Coords : " + myCoords;
			}

			function errorCallback(e) {
				alert(e);
			}

		} else {
			//alert("Not Allowed");
		}

	</script>
	</head>
	<body>
		<div class="game">
			<ul id="playerList">
			<strong><li id="me"></li></strong>
			</ul>
		</div>
	</body>


</html>